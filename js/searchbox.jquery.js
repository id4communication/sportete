(function($){		/**	 * Plugin de la boite de recherche avancée du site Sport'Été	 * 	 * @author : Artscore Studio (info@artscore-studio.fr)	 * @version : 0.1	 */	$.fn.searchbox = function(options)	{		/**		 * Options par défaut		 */		var defaults = {			selected_univers: [],			selected_activities: [],			selected_destinations: [],			selected_ages: [],		}				// Options de l'instance du plugin en cours		var opts = {};				/**		 * Initialisation du plugin		 */		var init = function(options)		{			// Fusion des options par défaut avec les options données au plugin			opts = $.extend(defaults, options);						// Initialisation des clics sur les liens			methods.initClickEventOnLinks();						// Initialisation des événements de suppression de critère			$('#recherche_details').find('a.selected').each(function(){				var $anchor = $(this);				methods.attachDeleteEventOnSelectedCriteria($anchor);			});						// Vérification qu'il y a des mots-clés en session au chargement d'une page			methods.initSessionKeywords();		}				/**		 * Liste des méthodes du plugin		 */		var methods = {						initSessionKeywords: function()			{				$('#recherche_details').find('.hidden_criteria').each(function(){					var anchor = $(this).find('a');					var ul = $(this).parent();					var family_criteria = ul.attr('id');					methods.addCriteria(anchor, family_criteria);				});							},						/**			 * Initialisation du click sur les liens dans listes			 */			initClickEventOnLinks: function()			{				$('.rechercheavanceecorpsdetails').each(function(){					$(this).find('a').each(function(){						methods.attachEventClickAddCriteria(this);					});				});			},						/**			 * Evenement onClick pour l'ajout d'un critère de recherche			 * 			 * @param <object> element : DOM Element sur lequel on rattache l'événement onClick 			 */			attachEventClickAddCriteria: function(element)			{				var list = $(element).parent().parent();				var family_criteria = $(list).attr('id');								$(element).click(function(event){					event.preventDefault();					var clone = $(this).clone();										if (true === methods.addCriteria($(this), family_criteria)) {						$(this).parent().fadeOut('slow', function(){							$(this).addClass('hidden_criteria');							methods.addCriteriaToFamilyCriteriaSelectedList(family_criteria, clone);							methods.refreshResult();						});					}				});			},						/**			 * Attache l'évènement pour enlever un critère de recherche			 * 			 * @param <object> element : DOM Element sur lequel on rattache l'événement onClick			 */			attachDeleteEventOnSelectedCriteria: function (element)			{				$(element).click(methods.deleteSelectedCriteria);			},						/**			 * Ajout du critère de recherche dans la zone de critères sélectionnés			 * 			 * @param <string> family_criteria Catégorie de critère			 * @param <object> element DOM Element à copier/coller			 */			addCriteriaToFamilyCriteriaSelectedList: function(family_criteria, element)			{				var $list = $('#' + family_criteria);				var $header = $('#' + family_criteria + '_heading');				var $dropzone = $header.find('#selection');								if ($dropzone.length == 0) {					$dropzone = $('<div id="selection"></div>');					$header.append($dropzone);				}								var $anchor = $('<a class="selected" style="display:none" data-id="' + $(element).attr('data-id') + '"></a>');				var $delete_img = $('<img src="/bundles/sportetewebsite/images/rechercheavancee_deselect.png" width="16" height="16" class="deselect">');								methods.attachDeleteEventOnSelectedCriteria($anchor);								$anchor.text(element.text());				$anchor.append($delete_img);				$dropzone.append($anchor);				$anchor.fadeIn('fast');			},						/**			 * Déselection d'un critère			 * 			 * @param event Evénement propagé par le clic			 */			deleteSelectedCriteria: function(event)			{				event.preventDefault();								var header = $(this).parent().parent();				var explode_string = $(header).attr('id').split('_');				var list_id = explode_string[0] + '_' + explode_string[1];				var $list = $('#' + list_id);				var id = $(this).attr('data-id');				var element_to_remove = this;								$list.find('.hidden_criteria').each(function(){					var anchor = $(this).find('a');					var li = this;										if ($(anchor).attr('data-id') == id) {						$(element_to_remove).hide('fast', function(){							if (true === methods.delCriteria(anchor, list_id)) {								$(this).remove();								$(li).show('slow');								methods.refreshResult();							}						});					}				});			},						/**			 * METHODES DE TRAITEMENT			 * ======================================================== 			 */						/**			 * Ajout du critère de recherche dans le tableau des critères de recherche			 * 			 * @param <object> criteria DOM Element représentant le critère			 * @param <string> family_criteria Catégorie de critère			 */			addCriteria: function(criteria, family_criteria)			{				var search_value = $(criteria).attr('data-keywords');				if(family_criteria == 'univers_criterias') {					opts.selected_univers.push(search_value);				} else if(family_criteria == 'activities_criterias') {					opts.selected_activities.push(search_value);				} else if(family_criteria == 'destinations_criterias') {					opts.selected_destinations.push(search_value);				} else if(family_criteria == 'age_criterias') {					opts.selected_ages.push(search_value);				}				return true;			},			/**			 * Supprime un critère de recherche dans le tableau des critères de recherche			 * 			 * @param <object> criteria DOM Element représentant le critère			 * @param <string> family_criteria Catégorie de critère			 */			delCriteria: function(criteria, family_criteria)			{				var search_value = $(criteria).attr('data-keywords');				var key = null;				var new_array = [];								if(family_criteria == 'univers_criterias') {					$(opts.selected_univers).each(function(item, value){						if (value != search_value) {							new_array.push(value);						}					});					opts.selected_univers = new_array;				} else if(family_criteria == 'activities_criterias') {					$(opts.selected_activities).each(function(item, value){						if (value != search_value) {							new_array.push(value);						}					});					opts.selected_activities = new_array;				} else if(family_criteria == 'destinations_criterias') {					$(opts.selected_destinations).each(function(item, value){						if (value != search_value) {							new_array.push(value);						}					});					opts.selected_destinations = new_array;				} else if(family_criteria == 'age_criterias') {					$(opts.selected_ages).each(function(item, value){						if (value != search_value) {							new_array.push(value);						}					});					opts.selected_ages = new_array;				}				return true;			},						/**			 * Lance la recherche			 */			refreshResult: function()			{				if ($('#recherche_avancee').attr('data-url-univers') == '') {					var url = '/sejours-stages';				} else {					var url = '/' + $('#recherche_avancee').attr('data-url-univers') + '/sejours-stages';				}												// Récupération de l'univers sélectionné				var first = true;				var is_params = false;				$(opts.selected_univers).each(function(item, value){					is_params = true;					if (first == true) {						url += '/' + value;					} else {						url += '-ou-' + value;					}					first = false;				});								// Récupération des activities sélectionnées				var first = true;				$(opts.selected_activities).each(function(item, value){					is_params = true;					if (first == true) {						url += '/' + value;					} else {						url += '-ou-' + value;					}					first = false;				});								// Récupération des destinations sélectionnées				var first = true;				$(opts.selected_destinations).each(function(item, value){					is_params = true;					if (first == true) {						url += '/' + value;					} else {						url += '-ou-' + value;					}					first = false;				});								// Récupération des activities sélectionnées				var first = true;				$(opts.selected_ages).each(function(item, value){					is_params = true;					if (first == true) {						url += '/' + value;					} else {						url += '-ou-' + value;					}					first = false;				});								if (is_params == false) {					url += '/tous-les-sejours';				}				$.get(url, function(data){					$('#titrepage').html('Résultat');					$('.pagecontent').html(data);				});			}		}				init(options);		return false;	}	})(jQuery);